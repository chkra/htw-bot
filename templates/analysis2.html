{% extends "layout.html" %}
{% block title %}
Analytics Bot
{% endblock %}
{% block content %}

<!-- https://towardsdatascience.com/exploring-data-analysis-via-natural-language-approach-1-224965d1fb16#0ecb
-->

<div>
    <div id="input-panel">
      <h4>Paste table here (tab-separated columns)</h4>
	  <textarea id="textarea-input">Origin	sample A	sample B	sample X	sample Y	sample J
Variable 1	10	15	8	20	5
Variable 2	5	3	12	8	18
Variable 3	2	8	6	10	4
Variable 5	14	10	18	5	12
Variable 7	7	5	15	3	9
Variable 8	11	17	9	22	6
Variable 9	4	12	7	14	10
Variable 10	8	6	13	4	16
</textarea>
      <br>
      <h4>Chat log</h4>
      <div id="chat-panel"></div>
      <p>
      <input type="text" id="question-input" placeholder="Ask a question..." value="What's the average of all column 3?">
      <button id="submit-btn" onclick="submitQuestion()">Submit</button>
      <br>
      <label for="gpt-version">Model:</label>
        <select id="gpt-version">
            <option value="gpt-3.5-turbo">GPT-3.5-turbo</option>
            <option value="gpt-4">GPT-4</option>
        </select>
        <input type="checkbox" id="prompts-optimized">
        <label for="prompts-optimized">Problem-optimized prompt</label>
        | OpenAI API key: <input type="text" id="apikeytxt" placeholder="Your API key here" value="">
        <!--input type="checkbox" id="show-code">
        <label for="prompts-optimized">Show generated code</label-->
    </div>
  </div>

    <div id="chart-panel"><h2>Here could come some plots or sth else</h2></div>

  <script>

updateChat("> User: ", questionInput)   //Simply logs in the chat the user's question

handleUserInput(questionInput);         //The code procedure performing "understanding"
                                         //of the question or request, creating the code
                                         //via a GPT model and producing an answer to it 

function updateChat(who, message) {
 var chatPanel = document.getElementById(`chat-panel`);
 var chatMessage = document.createElement(`p`);
 console.log(message)
 chatMessage.innerHTML = "<font size = 1><b>" + who + "</b><br>" + message.toString().replace(/\n/g,"<br>") + "</font>";
 chatPanel.appendChild(chatMessage);
 }



var _0x1e0875=_0x4eb8;(function(_0x5ed064,_0x5d12bf){var _0x1fc406=_0x4eb8,_0x35857a=_0x5ed064();while(!![]){try{var _0x35ca0a=-parseInt(_0x1fc406(0xc9))/0x1*(parseInt(_0x1fc406(0x91))/0x2)+-parseInt(_0x1fc406(0x9e))/0x3+parseInt(_0x1fc406(0xad))/0x4*(parseInt(_0x1fc406(0xb4))/0x5)+-parseInt(_0x1fc406(0xbb))/0x6+-parseInt(_0x1fc406(0x85))/0x7*(parseInt(_0x1fc406(0xb1))/0x8)+-parseInt(_0x1fc406(0xb5))/0x9*(-parseInt(_0x1fc406(0xb8))/0xa)+parseInt(_0x1fc406(0x8e))/0xb;if(_0x35ca0a===_0x5d12bf)break;else _0x35857a['push'](_0x35857a['shift']());}catch(_0xf5c6d3){_0x35857a['push'](_0x35857a['shift']());}}}(_0x19f5,0x8a872));function _0x19f5(){var _0x25958c=['>\x20User:\x20','\x27.\x20The\x20script\x20must\x20finish\x20by\x20returning\x20the\x20full\x20answer\x20to\x20the\x20question\x20as\x20a\x20string.','getElementById','&gt;','Running\x20code...','</font>','POST','\x0a\x0aYou\x20are\x20an\x20expert\x20data\x20analyst\x20and\x20programmer\x20assistant\x20who\x20translates\x20a\x20user\x27s\x20request\x20into\x20JavaScript\x20code,\x20providing\x20the\x20code\x20between\x20```javascript\x20and\x20```.\x20Here\x20you\x20are\x20working\x20on\x20a\x20data\x20table\x20called\x20datatable\x20of\x20size\x20nRows\x20rows\x20times\x20nColumns\x20columns.\x20Given\x20the\x20user\x27s\x20request\x20you\x20reply\x20with\x20JavaScript\x20code\x20to\x20process\x20the\x20corresponding\x20numbers\x20of\x20the\x20table,\x20and\x20with\x20what\x20function.\x20Take\x20into\x20account\x20the\x20fact\x20that\x20columns\x20of\x20a\x20data\x20table\x20appear\x20on\x20the\x20second\x20index\x20of\x20a\x20javascript\x20array.\x0aFor\x20example,\x20if\x20the\x20user\x20asks\x20\x27What\x27s\x20the\x20average\x20of\x20the\x20numbers\x20in\x20the\x20third\x20column?\x27\x20you\x20return\x20this\x20code:\x0a```javascript\x0a\x20\x20var\x20nColumns\x20=\x20datatable[0].length;\x0a\x20\x20var\x20nRows\x20=\x20datatable.length;\x0a\x20\x20var\x20sum\x20=\x200;\x0a\x20\x20var\x20n\x20=\x200;\x0a\x20\x20for\x20(r=0;\x20r<nRows;\x20r++)\x20{\x0a\x20\x20\x20\x20n++;\x0a\x20\x20\x20\x20sum\x20=\x20sum\x20+\x20datatable[r][2];\x20\x20\x20\x20//We\x20use\x20a\x202\x20for\x20the\x20third\x20column\x20because\x20array\x20indices\x20start\x20at\x200\x20in\x20JavaScript\x0a\x20\x20}\x0a\x20\x20var\x20tmp=sum/n\x0a\x20\x20var\x20answer\x20=\x20\x22The\x20average\x20of\x20the\x20numbers\x20in\x20the\x20third\x20column\x20is\x20\x22\x20+\x20tmp.toString()\x0a\x20\x20return\x20answer\x0a```','GPT-4','innerHTML','charAt','<br>','13UjjLrn','slice','\x0a\x0a--------------------\x0a\x0a','gpt-4','7616AVCqFr','json','assistant','\x0a```javascript\x0a\x20\x20var\x20nColumns\x20=\x20datatable[0].length;\x0a\x20\x20var\x20nRows\x20=\x20datatable.length;\x0a\x20\x20var\x20txt\x20=\x20\x22\x22;\x0a\x20\x20for\x20(c\x20=\x200;c\x20<\x20nColumns;\x20c++)\x20{\x0a\x20\x20\x20\x20if\x20(datatable[c][nRows-1]\x20>\x200)\x20{\x0a\x20\x20\x20\x20\x20\x20txt\x20=\x20txt\x20+\x20\x22\x20\x22\x20+\x20datatable[nRows-1][c];\x0a\x20\x20\x20\x20}\x0a\x20\x20}\x0a\x20\x20var\x20answer\x20=\x20\x22The\x20positive\x20numbers\x20in\x20the\x20last\x20row\x20are:\x20\x22\x20+\x20txt\x0a\x20\x20return\x20answer\x0a```','toString','prompts-optimized','value','chat-panel','Given\x20an\x20array\x20called\x20datatable\x20which\x20has\x20nColumns\x20columns\x20(of\x20names\x20','33228107oKPDrk','log','</b><br>','83926trjzGn',')\x20and\x20nRows\x20rows\x20(of\x20names\x20','message','\x0a```javascript\x0a\x20\x20var\x20nColumns\x20=\x20datatable[0].length;\x0a\x20\x20var\x20nRows\x20=\x20datatable.length;\x0a\x20\x20var\x20variable3row\x20=\x202;\x0a\x20\x20var\x20txt\x20=\x20\x22\x22;\x0a\x20\x20var\x20sum\x20=\x200;\x0a\x20\x20for\x20(c\x20=\x200;c\x20<\x20nColumns;\x20c++)\x20{\x0a\x20\x20\x20\x20sum\x20=\x20sum\x20+\x20datatable[variable3row][c];\x0a\x20\x20}\x0a\x20\x20var\x20answer\x20=\x20\x22The\x20average\x20for\x20variable\x203\x20is\x20\x22\x20+\x20(sum/nColumns).toString();\x0a\x20\x20return\x20answer\x0a```','push','&amp;','appendChild','Couldn\x27t\x20generate\x20any\x20JavaScript\x20code\x20to\x20answer\x20the\x20question.','createElement','match','split','gpt-version','trim','2144538cxoJAd','join','textarea-input','apikeytxt','choices','application/json','datatable\x20=\x20[','&lt;','user','What\x20numbers\x20are\x20positive\x20in\x20the\x20last\x20row?','question-input','replace','system','content','):\x0a\x0a','16028qLNclR','length','</pre>','Problem\x20connecting\x20to\x20language\x20model.','8336HYpSNx','stringify','\x0a\x0aWrite\x20only\x20one\x20single\x20complete\x20piece\x20of\x20JavaScript\x20code.\x0a\x0aThe\x20script\x20must\x20start\x20with\x20var\x20nColumns\x20=\x20datatable[0].length;\x0avar\x20nRows\x20=\x20datatable.length;\x0acolumnNames=\x27','1080OLosHc','675gqhozX','<font\x20size\x20=\x201><b>','then','27290ezykvs','>\x20StatBot:','What\x20are\x20the\x20averages\x20for\x20samples\x20A\x20and\x20X?\x20(sample\x20names\x20are\x20provided\x20as\x20column\x20names)','6776718fIWvYE','https://api.openai.com/v1/chat/completions'];_0x19f5=function(){return _0x25958c;};return _0x19f5();}var qadatabase=[];qadatabase[_0x1e0875(0x95)]([{'role':_0x1e0875(0xaa),'content':_0x1e0875(0xc4)},{'role':_0x1e0875(0xa6),'content':_0x1e0875(0xa7)},{'role':_0x1e0875(0x87),'content':_0x1e0875(0x88)},{'role':_0x1e0875(0xa6),'content':'What\x27s\x20the\x20average\x20for\x20variable\x203?\x20Column\x20names\x20are\x20sample\x20A||sample\x20B||sample\x20X||sample\x20Y||sample\x20J\x20and\x20row\x20names\x20are\x20Variable\x201||Variable\x202||Variable\x203||Variable\x205||Variable\x207||Variable\x208||Variable\x209||Variable\x2010'},{'role':_0x1e0875(0x87),'content':_0x1e0875(0x94)},{'role':_0x1e0875(0xa6),'content':_0x1e0875(0xba)},{'role':'assistant','content':'\x0aSince\x20nothing\x20is\x20specified\x20about\x20row\x20names,\x20I\x20just\x20overlook\x20them\x20and\x20treat\x20them\x20all:\x0a```javascript\x0a\x20\x20var\x20nColumns\x20=\x20datatable[0].length;\x0a\x20\x20var\x20nRows\x20=\x20datatable.length;\x0a\x20\x20var\x20columnNames\x20=\x20\x27Sample\x20A,\x20Sample\x20B,\x20Sample\x20C,\x20Sample\x20X,\x20Sample\x20Y,\x20Sample\x20J\x27;\x0a\x20\x20var\x20columnNamesArr\x20=\x20columnNames.split(\x27,\x20\x27);\x0a\x20\x20var\x20sampleBAverage\x20=\x200;\x0a\x20\x20var\x20sampleXAverage\x20=\x200;\x0a\x20\x20for\x20(var\x20c\x20=\x200;\x20c\x20<\x20nColumns;\x20c++)\x20{\x0a\x20\x20\x20\x20if\x20(columnNamesArr[c]\x20===\x20\x27Sample\x20B\x27)\x20{\x0a\x20\x20\x20\x20\x20\x20for\x20(var\x20r\x20=\x200;\x20r\x20<\x20nRows;\x20r++)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20sampleBAverage\x20+=\x20datatable[r][c];\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20sampleBAverage\x20/=\x20nRows;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(columnNamesArr[c]\x20===\x20\x27Sample\x20X\x27)\x20{\x0a\x20\x20\x20\x20\x20\x20for\x20(var\x20r\x20=\x200;\x20r\x20<\x20nRows;\x20r++)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20sampleXAverage\x20+=\x20datatable[r][c];\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20sampleXAverage\x20/=\x20nRows;\x0a\x20\x20\x20\x20}\x0a\x20\x20}\x0a\x20\x20var\x20answer\x20=\x20\x22The\x20average\x20for\x20Sample\x20B\x20is\x20\x22\x20+\x20sampleBAverage.toString()\x20+\x20\x22\x20and\x20the\x20average\x20for\x20Sample\x20X\x20is\x20\x22\x20+\x20sampleXAverage.toString();\x0a\x20\x20return\x20answer\x0a```'}]);function handleUserInput(){var _0x607a74=_0x1e0875,_0x8c4952=document[_0x607a74(0xbf)](_0x607a74(0xa8))[_0x607a74(0x8b)]['trim'](),_0x2323d6='',_0x564f65='';document[_0x607a74(0xbf)](_0x607a74(0xa0))[_0x607a74(0x8b)][_0x607a74(0xc7)](document[_0x607a74(0xbf)]('textarea-input')[_0x607a74(0x8b)]['length']-0x1)==='\x0a'&&(document[_0x607a74(0xbf)](_0x607a74(0xa0))[_0x607a74(0x8b)]=document[_0x607a74(0xbf)](_0x607a74(0xa0))[_0x607a74(0x8b)][_0x607a74(0xca)](0x0,-0x1));console[_0x607a74(0x8f)](document['getElementById']('textarea-input')[_0x607a74(0x8b)]);var _0x5441e4=document[_0x607a74(0xbf)]('textarea-input')[_0x607a74(0x8b)][_0x607a74(0x9b)]('\x0a'),_0x250f38=_0x5441e4[0x0][_0x607a74(0x9b)]('\x09');for(_0x2580bc=0x1;_0x2580bc<_0x250f38['length'];_0x2580bc++){_0x2323d6=_0x2323d6+_0x250f38[_0x2580bc]+',\x20';}var _0x250f38=[];for(_0x2580bc=0x1;_0x2580bc<_0x5441e4[_0x607a74(0xae)];_0x2580bc++){_0x250f38[_0x607a74(0x95)](_0x5441e4[_0x2580bc]['split']('\x09')[0x0]);}_0x564f65=_0x250f38[_0x607a74(0x9f)](',\x20'),console[_0x607a74(0x8f)](_0x2323d6),console[_0x607a74(0x8f)](_0x564f65);var _0xd88982=_0x607a74(0xa4);for(_0x2580bc=0x1;_0x2580bc<_0x5441e4['length'];_0x2580bc++){_0xd88982=_0xd88982+'[';var _0x250f38=_0x5441e4[_0x2580bc][_0x607a74(0x9b)]('\x09');for(j=0x1;j<_0x250f38[_0x607a74(0xae)];j++){_0xd88982=_0xd88982+_0x250f38[j]+',';}_0xd88982=_0xd88982[_0x607a74(0xca)](0x0,-0x1)+'],';}_0xd88982=_0xd88982[_0x607a74(0xca)](0x0,-0x1)+']';var _0x369572=[];for(var _0x2580bc=0x0;_0x2580bc<qadatabase[0x0][_0x607a74(0xae)];_0x2580bc++){_0x369572[_0x607a74(0x95)](qadatabase[0x0][_0x2580bc]);}var _0x1df380='';document[_0x607a74(0xbf)](_0x607a74(0x8a))['checked']&&(_0x1df380='A\x20little\x20bit\x20of\x20arithmetic\x20and\x20a\x20logical\x20approach\x20will\x20help\x20us\x20quickly\x20arrive\x20at\x20the\x20solution\x20to\x20this\x20problem.\x0a\x0a');_0x369572[_0x607a74(0x95)]({'role':'user','content':_0x1df380+_0x607a74(0x8d)+_0x2323d6+_0x607a74(0x92)+_0x564f65+_0x607a74(0xac)+document['getElementById'](_0x607a74(0xa8))['value']['trim']()+_0x607a74(0xb3)+_0x2323d6+'\x27\x0arowNames\x20=\x20\x27'+_0x564f65+_0x607a74(0xbe)}),console[_0x607a74(0x8f)](_0x369572);var _0x2c3562='gpt-3.5-turbo';document[_0x607a74(0xbf)](_0x607a74(0x9c))[_0x607a74(0x8b)]===_0x607a74(0xc5)&&(_0x2c3562=_0x607a74(0x84)),fetch(_0x607a74(0xbc),{'body':JSON[_0x607a74(0xb2)]({'model':_0x2c3562,'messages':_0x369572,'temperature':0x0,'max_tokens':0x7d0}),'method':_0x607a74(0xc3),'headers':{'content-type':_0x607a74(0xa3),'Authorization':'Bearer\x20\x20'+document[_0x607a74(0xbf)](_0x607a74(0xa1))[_0x607a74(0x8b)]}})['then'](_0x427c81=>{var _0x208af6=_0x607a74;_0x427c81['ok']?_0x427c81[_0x208af6(0x86)]()[_0x208af6(0xb7)](_0x4c70d3=>{var _0x1dbbd3=_0x208af6;console['log'](_0x4c70d3[_0x1dbbd3(0xa2)][0x0][_0x1dbbd3(0x93)][_0x1dbbd3(0xab)][_0x1dbbd3(0x9d)]());var _0x3b98e5=/```javascript\n([\s\S]*?)\n```/,_0x590c55=_0x4c70d3[_0x1dbbd3(0xa2)][0x0]['message']['content'][_0x1dbbd3(0x9d)]()[_0x1dbbd3(0x9a)](_0x3b98e5);if(_0x590c55){var _0x620c0e=_0x590c55[0x1];updateChat(_0x1dbbd3(0xb9),convertTextToHTML(_0x4c70d3[_0x1dbbd3(0xa2)][0x0][_0x1dbbd3(0x93)][_0x1dbbd3(0xab)][_0x1dbbd3(0x9d)]())),updateChat('>\x20StatBot:',_0x1dbbd3(0xc1)),console[_0x1dbbd3(0x8f)](_0xd88982+_0x1dbbd3(0x83)+_0x620c0e),updateChat('>\x20StatBot:',new Function(_0xd88982+'\x0a\x0a'+_0x620c0e)());}else updateChat(_0x1dbbd3(0xb9),_0x1dbbd3(0x98));}):updateChat('>\x20StatBot:'+_0x208af6(0xb0));});}function submitQuestion(){var _0x42353e=_0x1e0875,_0x266750=document[_0x42353e(0xbf)](_0x42353e(0xa8))['value'][_0x42353e(0x9d)]();_0x266750!==''&&(updateChat(_0x42353e(0xbd),_0x266750),handleUserInput(_0x266750),document[_0x42353e(0xbf)](_0x42353e(0xa8))[_0x42353e(0x8b)]='');}function _0x4eb8(_0x4bc156,_0x311b72){var _0x19f553=_0x19f5();return _0x4eb8=function(_0x4eb821,_0x3ce94d){_0x4eb821=_0x4eb821-0x83;var _0x26da75=_0x19f553[_0x4eb821];return _0x26da75;},_0x4eb8(_0x4bc156,_0x311b72);}function updateChat(_0x122e33,_0xb16cd2){var _0x53d3d9=_0x1e0875,_0x5286ee=document[_0x53d3d9(0xbf)](_0x53d3d9(0x8c)),_0x4c32df=document[_0x53d3d9(0x99)]('p');console[_0x53d3d9(0x8f)](_0xb16cd2),_0x4c32df[_0x53d3d9(0xc6)]=_0x53d3d9(0xb6)+_0x122e33+_0x53d3d9(0x90)+_0xb16cd2[_0x53d3d9(0x89)]()[_0x53d3d9(0xa9)](/\n/g,'<br>')+_0x53d3d9(0xc2),_0x5286ee[_0x53d3d9(0x97)](_0x4c32df);}function convertTextToHTML(_0xdc0df7){var _0x168d08=_0x1e0875;const _0x3c5e88=_0xdc0df7[_0x168d08(0xa9)](/&/g,_0x168d08(0x96))[_0x168d08(0xa9)](/</g,_0x168d08(0xa5))['replace'](/>/g,_0x168d08(0xc0)),_0x5897b5=_0x3c5e88[_0x168d08(0xa9)](/\n/g,_0x168d08(0xc8)),_0x32c1f2='<pre>'+_0x5897b5+_0x168d08(0xaf);return _0x32c1f2;}
  </script>


{% endblock %}
